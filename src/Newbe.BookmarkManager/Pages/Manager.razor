@page "/Manager/index.html"
@using Newbe.BookmarkManager.Services
@inherits Blazor.BrowserExtension.Pages.IndexPage

<Layout>
    <Header>
        <Row>
            <Col Span="20">
                <Title Style="color: white">
                    <Image Src="/icons/32icon.png" Height="32" Preview="false"></Image>
                    Amazing Favorites
                </Title>
            </Col>
            <Col Style="text-align: right" Span="4">
                <Space>
                    <SpaceItem>
                        <LikeProject/>
                    </SpaceItem>
                    <SpaceItem>
                        <Button OnClick="OpenHelp">
                            <Icon Type="question-circle" Theme="twotone"/>
                        </Button>
                    </SpaceItem>
                    <SpaceItem>
                        <Button OnClick="OpenControlPanel">
                            <Icon Type="setting" Theme="twotone"/>
                        </Button>
                    </SpaceItem>
                </Space>
            </Col>
        </Row>
    </Header>
    <Content>
        <Row>
            <Col Span="24">
                <AntList Bordered DataSource="@_targetBks">
                    <Header>
                        <Row Gutter="(16,24)">
                            <Col Span="24">
                                <TipsAlert/>
                            </Col>
                            <Col Span="24">
                                <Spin Spinning="@_searchInputLoading">
                                    <Search Placeholder="input keyword to search"
                                            OnInput="OnSearchInput"
                                            OnkeyDown="OnSearchInputKeydown"
                                            OnkeyUp="OnSearchInputKeyup"
                                            @ref="_search"
                                            EnterButton="true"
                                            AutoFocus="true"
                                            @bind-Value="@_searchValue"/>
                                </Spin>
                            </Col>
                            @if (_userOptions?.HotTagsFeature?.Enabled == true)
                            {
                                <antdesign.Col Span="10">
                                    <HotTags OnTagClick="e => OnClickTag(e.Tag.Tag)"/>
                                </antdesign.Col>
                            }
                        </Row>
                    </Header>
                    <ChildContent Context="bk">
                        <ListItem>
                            <Col Span="24">
                                @if (bk.ShowIndex && bk.LineIndex < 10)
                                {
                                    <code>alt + </code>
                                }
                                @bk.LineIndex
                                <Button Type="link"
                                        OnClick="e => OnClickUrl(bk, e)">
                                    <Space>
                                        <SpaceItem>
                                            @if (!string.IsNullOrEmpty(bk.Bk.FavIconUrl))
                                            {
                                                <Badge Count="bk.Bk.ClickedCount"
                                                       Size="small"
                                                       Style="background-color: #52c41a; ">
                                                    <ChildContent>
                                                        <Image Width="16px"
                                                               Height="16px"
                                                               Preview="false"
                                                               Src="@bk.Bk.FavIconUrl"
                                                               Fallback="@WebHelper.DefaultImagePlaceHolder"/>
                                                    </ChildContent>
                                                </Badge>
                                            }
                                        </SpaceItem>
                                        <SpaceItem Style="width: 100%">@bk.Bk.Title</SpaceItem>
                                    </Space>
                                </Button>
                                @if (bk.Bk.Tags != null)
                                {
                                    @foreach (var tag in bk.Bk.Tags)
                                    {
                                        <Tag Closable="true"
                                             OnClosing="e => OnRemovingTag(bk.Bk, tag)"
                                             OnClick="e => OnClickTag(tag)"
                                             Color="@WebHelper.GetTagColor(tag)">
                                            @tag
                                        </Tag>
                                    }
                                }
                                <TagInput OnNewTagsCreated="e => OnNewTagsAddAsync(bk, e.Tags)"
                                          Options="_allTags">
                                </TagInput>
                            </Col>
                        </ListItem>
                    </ChildContent>
                    <Footer>

                    </Footer>
                </AntList>
            </Col>
        </Row>
    </Content>
    <Footer>
        Welcome to submit you suggestion at <a href="https://github.com/newbe36524/Amazing-Favorites" target="_blank">github.com</a>
    </Footer>
</Layout>
<ControlPanel OnClickResumeFactorySetting="OnClickResumeFactorySetting"
              OnUserOptionSave="OnUserOptionSave"
              @bind-Visible="_controlPanelVisible"/>