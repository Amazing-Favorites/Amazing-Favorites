@page "/Manager/index.html"
@using Newbe.BookmarkManager.Services
@inherits Blazor.BrowserExtension.Pages.IndexPage

<Layout>
    <Header>
        <Row>
            <Col Span="20">
                <Title Style="color: white">
                    <Image Src="/icons/32icon.png" Height="32"></Image>
                    Amazing Favorites
                </Title>
            </Col>
            <Col Style="text-align: right" Span="4">
                <Space>
                    <SpaceItem>
                        <Button OnClick="OpenHelp">
                            <Icon Type="question-circle" Theme="twotone"/>
                        </Button>
                    </SpaceItem>
                    <SpaceItem>
                        <Button OnClick="OpenControlPanel">
                            <Icon Type="setting" Theme="twotone"/>
                        </Button>
                    </SpaceItem>
                </Space>
            </Col>
        </Row>
    </Header>
    <Content>
        <Row>
            <Col Span="24">
                <AntList Bordered DataSource="@_targetBks">
                    <Header>
                        <Row>
                            <Col Span="24">
                                <Alert Type="@AlertType.Success" Message="@_searchTips[_searchTipIndex]"/>
                            </Col>
                        </Row>
                        <Row>
                            <Col Span="24">
                                <Spin Spinning="@_searchInputLoading">
                                    <Search Placeholder="input keyword to search"
                                            OnInput="OnSearchInput"
                                            OnkeyDown="OnSearchInputKeydown"
                                            OnkeyUp="OnSearchInputKeyup"
                                            @ref="_search"
                                            EnterButton="true"
                                            AutoFocus="true"
                                            @bind-Value="@_searchValue"/>
                                </Spin>
                            </Col>
                        </Row>
                    </Header>
                    <ChildContent Context="bk">
                        <ListItem>
                            <Col Span="24">
                                @if (bk.ShowIndex && bk.LineIndex < 10)
                                {
                                    <code>alt + </code>
                                }
                                @bk.LineIndex
                                <Button Type="link"
                                        OnClick="e => OnClickUrl(bk)">
                                    <Space>
                                        <SpaceItem>
                                            @if (!string.IsNullOrEmpty(bk.Bk.FavIconUrl))
                                            {
                                                <Badge Count="bk.Bk.ClickedCount"
                                                       Size="small"
                                                       Style="background-color: #52c41a; ">
                                                    <ChildContent>
                                                        <Image Width="16px"
                                                               Height="16px"
                                                               Preview="false"
                                                               Src="@bk.Bk.FavIconUrl"
                                                               Fallback="@WebHelper.DefaultImagePlaceHolder"/>
                                                    </ChildContent>
                                                </Badge>
                                            }
                                        </SpaceItem>
                                        <SpaceItem Style="width: 100%">@bk.Bk.Title</SpaceItem>
                                    </Space>
                                </Button>
                                @if (bk.Bk.Tags != null)
                                {
                                    @foreach (var tag in bk.Bk.Tags)
                                    {
                                        <Tag Closable="true"
                                             OnClosing="e => OnRemovingTag(bk.Bk, tag)"
                                             OnClick="e => OnClickTag(bk.Bk, tag)"
                                             Color="@WebHelper.GetTagColor(tag)">
                                            @tag
                                        </Tag>
                                    }
                                }
                                <span style="display: @(bk.NewTagInputVisible ? "inline-block" : "none")">
                                    <Input OnPressEnter="e => OnCreatingTag(bk)"
                                           OnBlur="e => OnCreatingTag(bk)"
                                           @ref="@bk.NewTagRef"
                                           @bind-Value="@bk.NewTag"
                                           Placeholder="enter to add tag"
                                           AutoFocus/>
                                </span>
                                <span style="display: @(!bk.NewTagInputVisible ? "inline-block" : "none")">
                                    <Tag Class="site-tag-plus" OnClick="e => bk.NewTagInputVisible = true">
                                        <Icon Type="plus"/>New Tag
                                    </Tag>
                                </span>
                            </Col>
                        </ListItem>
                    </ChildContent>
                    <Footer>

                    </Footer>
                </AntList>
            </Col>
        </Row>
    </Content>
    <Footer>
        Welcome to submit you suggestion at <a href="https://github.com/newbe36524/Amazing-Favorites" target="_blank">github.com</a>
    </Footer>
</Layout>
<Modal Title="@("Control Panel")"
       Visible="@_modal.Visible"
       OnOk="@HandleUserOptionsOk"
       OnCancel="@HandleUserOptionsCancel"
       Width="1000">
    <Form Model="@_modal"
          LabelColSpan="4"
          WrapperColSpan="20"
          Size="Default">
        @if (context.AcceptPrivacyAgreement)
        {
            <FormItem Label="Enable Pinyin">
                <Switch @bind-Value="@context.PinyinFeature.Enabled"/>
            </FormItem>
            @if (context.PinyinFeature.Enabled)
            {
                <FormItem Label="Access Token">
                    <TextArea @bind-Value="@context.PinyinFeature.AccessToken" />
                    <p>
                        <Icon Type="question" Theme="outline"/>
                        You can get an access token from <a href="https://user.newbe.pro/Identity/Account/Manage/AccessToken" target="_blank">user.newbe.pro</a>.
                    </p>

                </FormItem>
                <FormItem Label="Pinyin Api BaseUrl">
                    <Input @bind-Value="@context.PinyinFeature.BaseUrl"/>
                </FormItem>
            }
            <FormItem Label="Enable Cloud Sync">
                <Switch @bind-Value="@context.CloudBkFeature.Enabled"/>
            </FormItem>
            @if (context.CloudBkFeature.Enabled)
            {
                <FormItem Label="Access Token">
                    <TextArea @bind-Value="@context.CloudBkFeature.AccessToken" />
                    <p>
                        <Icon Type="question" Theme="outline"/>
                        You can get an access token from <a href="https://user.newbe.pro/Identity/Account/Manage/AccessToken" target="_blank">user.newbe.pro</a>.
                    </p>

                </FormItem>
                <FormItem Label="Cloud Sync Api BaseUrl">
                    <Input @bind-Value="@context.CloudBkFeature.BaseUrl"/>
                </FormItem>
            }
        }
        else
        {
            <FormItem Label="User Privacy Agreement">
                <p>The following features may transfer some data to cloud servers, so please <a href="https://af.newbe.pro/docs/00-1-Privacy" target="_blank">click here</a>, read and understand our User Privacy Agreement. After you confirm and agree to the content of the agreement click the button below to enable the advanced features.</p>
                <p>Feature shows as below:</p>
                <ul>
                    <li>Pinyin Support. You could search your bookmark title and your tags by PinYin</li>
                    <li>Tags Cloud Sync. You could sync your bookmark tags in multiple device</li>
                </ul>
                <Button OnClick="OnClickAgreeUserPrivacyAgreement" Type="primary">I agree to the User Privacy Agreement</Button>
            </FormItem>
        }
        <FormItem Label="System Actions">
            <Button OnClick="OnClickDumpDataAsync">Dump data to console</Button>
            <Button OnClick="OnClickResumeFactorySetting" Danger>Resume factory setting</Button>
        </FormItem>
    </Form>
</Modal>